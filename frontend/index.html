<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SARTHI - Intelligent Incident Co-Pilot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset and Base Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            /* Color Palette */
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-200: #bfdbfe;
            --primary-300: #93c5fd;
            --primary-400: #60a5fa;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-800: #1e40af;
            --primary-900: #1e3a8a;

            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;

            --success-50: #f0fdf4;
            --success-500: #22c55e;
            --success-600: #16a34a;

            --warning-50: #fffbeb;
            --warning-500: #f59e0b;

            --error-50: #fef2f2;
            --error-500: #ef4444;
            --error-600: #dc2626;

            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 0.75rem;
            --spacing-lg: 1rem;
            --spacing-xl: 1.5rem;
            --spacing-2xl: 2rem;
            --spacing-3xl: 3rem;

            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);

            /* Transitions */
            --transition-fast: 150ms ease-in-out;
            --transition-normal: 250ms ease-in-out;
        }

        /* Typography */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--gray-900);
            background-color: var(--gray-50);
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.25;
            color: var(--gray-900);
        }

        h1 { font-size: 2rem; }
        h2 { font-size: 1.5rem; }
        h3 { font-size: 1.25rem; }
        h4 { font-size: 1.125rem; }

        /* Layout */
        .app {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: white;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
        }

        .sidebar-header {
            padding: var(--spacing-2xl);
            border-bottom: 1px solid var(--gray-200);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-600);
            text-align: center;
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--spacing-lg);
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            margin-bottom: var(--spacing-xs);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--gray-700);
            text-decoration: none;
        }

        .nav-item:hover {
            background-color: var(--gray-100);
            color: var(--gray-900);
        }

        .nav-item.active {
            background-color: var(--primary-50);
            color: var(--primary-700);
            border-right: 3px solid var(--primary-600);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: var(--spacing-md);
            flex-shrink: 0;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background-color: white;
            padding: var(--spacing-2xl);
            border-bottom: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--spacing-xs);
        }

        .page-subtitle {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-body {
            flex: 1;
            padding: var(--spacing-2xl);
            overflow-y: auto;
        }

        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-lg);
            background-color: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            margin-bottom: var(--spacing-lg);
        }

        .message {
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            max-width: 80%;
            word-wrap: break-word;
        }

        .message.user {
            background-color: var(--primary-600);
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .message.assistant {
            background-color: var(--gray-100);
            color: var(--gray-900);
        }

        .message-header {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .message-content {
            line-height: 1.6;
        }

        .message-meta {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: var(--spacing-xs);
        }

        .chat-input-container {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-lg);
            background-color: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            outline: none;
            transition: border-color var(--transition-fast);
        }

        .chat-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .send-button {
            padding: var(--spacing-md) var(--spacing-xl);
            background-color: var(--primary-600);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 500;
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .send-button:hover:not(:disabled) {
            background-color: var(--primary-700);
        }

        .send-button:disabled {
            background-color: var(--gray-400);
            cursor: not-allowed;
        }

        /* Dashboard Components */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .card {
            background-color: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .card-header {
            padding: var(--spacing-lg) var(--spacing-xl);
            border-bottom: 1px solid var(--gray-200);
            background-color: var(--gray-50);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .card-content {
            padding: var(--spacing-xl);
        }

        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: var(--spacing-md) var(--spacing-lg);
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .table th {
            font-weight: 600;
            color: var(--gray-700);
            background-color: var(--gray-50);
        }

        .table tbody tr:hover {
            background-color: var(--gray-50);
        }

        /* Forms */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: var(--spacing-xs);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            outline: none;
            transition: border-color var(--transition-fast);
        }

        .form-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--primary-600);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-700);
        }

        .btn-secondary {
            background-color: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background-color: var(--gray-300);
        }

        .btn-success {
            background-color: var(--success-500);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-600);
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: 0.75rem;
        }

        /* Status and Alerts */
        .alert {
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
        }

        .alert-success {
            background-color: var(--success-50);
            color: var(--success-600);
            border: 1px solid var(--success-500);
        }

        .alert-error {
            background-color: var(--error-50);
            color: var(--error-600);
            border: 1px solid var(--error-500);
        }

        .alert-warning {
            background-color: var(--warning-50);
            color: var(--warning-500);
            border: 1px solid var(--warning-500);
        }

        .alert-info {
            background-color: var(--primary-50);
            color: var(--primary-600);
            border: 1px solid var(--primary-500);
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--gray-300);
            border-radius: 50%;
            border-top-color: var(--primary-600);
            animation: spin 1s ease-in-out infinite;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-modal {
            background-color: white;
            padding: var(--spacing-2xl);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Observability */
        .observability-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: var(--spacing-lg);
            height: 100%;
        }

        .execution-log {
            background-color: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            overflow: hidden;
        }

        .execution-header {
            padding: var(--spacing-lg) var(--spacing-xl);
            border-bottom: 1px solid var(--gray-200);
            background-color: var(--gray-50);
        }

        .execution-content {
            padding: var(--spacing-lg);
            max-height: 500px;
            overflow-y: auto;
        }

        .execution-event {
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--primary-500);
            background-color: var(--gray-50);
        }

        .execution-event.agent-started {
            border-left-color: var(--primary-500);
        }

        .execution-event.tool-call {
            border-left-color: var(--warning-500);
        }

        .execution-event.agent-completed {
            border-left-color: var(--success-500);
        }

        .execution-event.final-response {
            border-left-color: var(--success-500);
            background-color: var(--success-50);
        }

        .execution-summary {
            background-color: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            padding: var(--spacing-xl);
        }

        .summary-item {
            margin-bottom: var(--spacing-lg);
        }

        .summary-label {
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--spacing-xs);
        }

        .summary-value {
            color: var(--gray-900);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--gray-200);
            }

            .sidebar-nav {
                display: flex;
                overflow-x: auto;
                padding: var(--spacing-md);
            }

            .nav-item {
                flex-shrink: 0;
                margin-right: var(--spacing-md);
                margin-bottom: 0;
            }

            .observability-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus states */
        .nav-item:focus,
        .btn:focus,
        .form-input:focus {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }

        /* Print styles */
        @media print {
            .sidebar,
            .chat-input-container {
                display: none;
            }

            .content-body {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <header class="sidebar-header">
                <h1 class="logo">SARTHI</h1>
            </header>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="chat" aria-label="Chat with SARTHI">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    Chat with SARTHI
                </a>
                <a href="#" class="nav-item" data-page="memory" aria-label="Memory Dashboard">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                    </svg>
                    Memory Dashboard
                </a>
                <a href="#" class="nav-item" data-page="agents" aria-label="Agent Management">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    Agents
                </a>
                <a href="#" class="nav-item" data-page="observability" aria-label="Observability & Explainability">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Observability
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="header">
                <div class="header-content">
                    <div>
                        <h1 class="page-title" id="page-title">Chat with SARTHI</h1>
                        <p class="page-subtitle" id="page-subtitle">AI-powered collaborative incident co-pilot for enterprise support</p>
                    </div>
                    <div id="header-actions"></div>
                </div>
            </header>

            <div class="content-area">
                <div class="content-body">
                    <!-- Chat Interface -->
                    <div id="chat-page" class="page active">
                        <div class="chat-container">
                            <div id="alerts-container"></div>
                            <div class="messages-container" id="messages-container">
                                <div class="message assistant">
                                    <div class="message-header">SARTHI</div>
                                    <div class="message-content">
                                        Hello! I'm your AI-powered incident co-pilot. I can help you with:
                                        <ul style="margin-top: 8px; padding-left: 20px;">
                                            <li>Analyzing incident patterns</li>
                                            <li>Providing troubleshooting guidance</li>
                                            <li>Accessing historical knowledge</li>
                                            <li>Documenting solutions</li>
                                        </ul>
                                        <br>
                                        How can I assist you today?
                                    </div>
                                    <div class="message-meta">Just now</div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <input
                                    type="text"
                                    id="chat-input"
                                    class="chat-input"
                                    placeholder="Ask me about incidents, errors, or system issues..."
                                    maxlength="1000"
                                    aria-label="Chat message input"
                                />
                                <button id="send-button" class="send-button" aria-label="Send message">
                                    Send
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Memory Dashboard -->
                    <div id="memory-page" class="page">
                        <div class="dashboard-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Memory Statistics</h3>
                                </div>
                                <div class="card-content">
                                    <div id="memory-stats">
                                        <div class="loading"></div>
                                        Loading memory statistics...
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Recent Memories</h3>
                                </div>
                                <div class="card-content">
                                    <div id="memory-list">
                                        <div class="loading"></div>
                                        Loading recent memories...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agents Page -->
                    <div id="agents-page" class="page">
                        <div class="dashboard-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Available Agents</h3>
                                </div>
                                <div class="card-content">
                                    <div id="agents-list">
                                        <div class="loading"></div>
                                        Loading agents...
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Document Ingestion</h3>
                                </div>
                                <div class="card-content">
                                    <form id="ingestion-form">
                                        <div class="form-group">
                                            <label for="source-type" class="form-label">Source Type</label>
                                            <select id="source-type" class="form-input" required>
                                                <option value="text">Text Content</option>
                                                <option value="url">URL</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="source-value" class="form-label">Content/URL</label>
                                            <input
                                                type="text"
                                                id="source-value"
                                                class="form-input"
                                                placeholder="Enter text content or URL"
                                                required
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label for="metadata" class="form-label">Metadata (JSON)</label>
                                            <textarea
                                                id="metadata"
                                                class="form-input form-textarea"
                                                placeholder='{"category": "incident", "priority": "high"}'
                                            ></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            Ingest Document
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Observability Page -->
                    <div id="observability-page" class="page">
                        <div class="observability-container">
                            <div class="execution-log">
                                <div class="execution-header">
                                    <h3 class="card-title">Live Execution Log</h3>
                                    <p class="page-subtitle">Real-time agent execution monitoring</p>
                                </div>
                                <div class="execution-content" id="execution-log">
                                    <div style="text-align: center; color: var(--gray-500); padding: var(--spacing-xl);">
                                        Start a conversation to see live execution events
                                    </div>
                                </div>
                            </div>
                            <div class="execution-summary">
                                <h3 class="card-title" style="margin-bottom: var(--spacing-lg);">Execution Summary</h3>
                                <div id="execution-summary">
                                    <div style="color: var(--gray-500);">
                                        No active execution
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-modal">
            <div class="loading" style="margin: 0 auto var(--spacing-lg);"></div>
            <p>Processing your request...</p>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            API_BASE: 'http://localhost:8000',
            MAX_RETRIES: 3,
            RETRY_DELAY: 1000
        };

        // Application State
        const state = {
            currentPage: 'chat',
            conversationId: null,
            currentExecutionId: null,
            eventSource: null
        };

        // DOM Elements
        const elements = {
            pages: document.querySelectorAll('.page'),
            navItems: document.querySelectorAll('.nav-item'),
            pageTitle: document.getElementById('page-title'),
            pageSubtitle: document.getElementById('page-subtitle'),
            chatInput: document.getElementById('chat-input'),
            sendButton: document.getElementById('send-button'),
            messagesContainer: document.getElementById('messages-container'),
            alertsContainer: document.getElementById('alerts-container'),
            loadingOverlay: document.getElementById('loading-overlay'),
            ingestionForm: document.getElementById('ingestion-form'),
            executionLog: document.getElementById('execution-log'),
            executionSummary: document.getElementById('execution-summary')
        };

        // Utility Functions
        const utils = {
            generateId: () => 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),

            formatTimestamp: (date) => {
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (minutes < 1) return 'Just now';
                if (minutes < 60) return `${minutes}m ago`;
                if (hours < 24) return `${hours}h ago`;
                return `${days}d ago`;
            },

            sanitizeHtml: (text) => {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            showAlert: (message, type = 'info', duration = 5000) => {
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.innerHTML = `
                    <span>${utils.sanitizeHtml(message)}</span>
                    <button onclick="this.parentElement.remove()" style="margin-left: auto; background: none; border: none; cursor: pointer;">√ó</button>
                `;
                elements.alertsContainer.appendChild(alert);

                if (duration > 0) {
                    setTimeout(() => {
                        if (alert.parentElement) {
                            alert.remove();
                        }
                    }, duration);
                }
            },

            showLoading: (show = true) => {
                elements.loadingOverlay.style.display = show ? 'flex' : 'none';
            },

            setPageTitle: (title, subtitle) => {
                elements.pageTitle.textContent = title;
                elements.pageSubtitle.textContent = subtitle;
            }
        };

        // API Client
        const api = {
            async request(endpoint, options = {}) {
                const url = `${CONFIG.API_BASE}${endpoint}`;
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                };

                for (let attempt = 1; attempt <= CONFIG.MAX_RETRIES; attempt++) {
                    try {
                        const response = await fetch(url, config);

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }

                        return await response.json();
                    } catch (error) {
                        if (attempt === CONFIG.MAX_RETRIES) {
                            throw error;
                        }
                        await new Promise(resolve => setTimeout(resolve, CONFIG.RETRY_DELAY * attempt));
                    }
                }
            },

            async sendChatMessage(message) {
                return this.request('/api/chat/query', {
                    method: 'POST',
                    body: JSON.stringify({
                        query: message,
                        attachments: [],
                        mode: 'chat'
                    })
                });
            },

            async getMemoryItems() {
                return this.request('/api/memory');
            },

            async getAgents() {
                return this.request('/api/agents');
            },

            async ingestDocument(sourceType, value, metadata) {
                return this.request('/api/agents/ingestion', {
                    method: 'POST',
                    body: JSON.stringify({
                        source_type: sourceType,
                        value: value,
                        metadata: metadata || {}
                    })
                });
            },

            async submitFeedback(executionId, rating, comment) {
                return this.request('/api/feedback', {
                    method: 'POST',
                    body: JSON.stringify({
                        execution_id: executionId,
                        rating: rating,
                        comment: comment
                    })
                });
            }
        };

        // UI Components
        const ui = {
            addMessage: (type, content, timestamp = new Date()) => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;

                const header = type === 'user' ? 'You' : 'SARTHI';
                const formattedTime = utils.formatTimestamp(timestamp);

                messageDiv.innerHTML = `
                    <div class="message-header">${header}</div>
                    <div class="message-content">${utils.sanitizeHtml(content)}</div>
                    <div class="message-meta">${formattedTime}</div>
                `;

                elements.messagesContainer.appendChild(messageDiv);
                elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
            },

            clearMessages: () => {
                elements.messagesContainer.innerHTML = '';
            },

            updateMemoryStats: (items) => {
                const statsDiv = document.getElementById('memory-stats');
                const episodicCount = items.filter(item => item.type === 'EPISODIC').length;
                const semanticCount = items.filter(item => item.type === 'SEMANTIC').length;

                statsDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary-600);">${episodicCount}</div>
                            <div style="color: var(--gray-600);">Episodic Memories</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary-600);">${semanticCount}</div>
                            <div style="color: var(--gray-600);">Semantic Memories</div>
                        </div>
                    </div>
                `;
            },

            updateMemoryList: (items) => {
                const listDiv = document.getElementById('memory-list');
                const recentItems = items.slice(0, 10);

                if (recentItems.length === 0) {
                    listDiv.innerHTML = '<p style="color: var(--gray-500);">No memories found</p>';
                    return;
                }

                const tableHtml = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Content</th>
                                <th>Source</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentItems.map(item => `
                                <tr>
                                    <td><span style="background: var(--gray-100); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">${item.type}</span></td>
                                    <td>${utils.sanitizeHtml(item.content.substring(0, 100))}${item.content.length > 100 ? '...' : ''}</td>
                                    <td>${item.source || 'N/A'}</td>
                                    <td>${new Date(item.created_at).toLocaleDateString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                listDiv.innerHTML = tableHtml;
            },

            updateAgentsList: (agents) => {
                const listDiv = document.getElementById('agents-list');

                if (!agents || agents.length === 0) {
                    listDiv.innerHTML = '<p style="color: var(--gray-500);">No agents available</p>';
                    return;
                }

                const agentsHtml = agents.map(agent => `
                    <div style="padding: var(--spacing-md); border: 1px solid var(--gray-200); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                        <div style="font-weight: 600; color: var(--gray-900);">${agent.name}</div>
                        <div style="color: var(--gray-600); font-size: 0.875rem; margin-top: var(--spacing-xs);">
                            ${agent.name === 'SelfServiceAgent' ? 'Handles user queries and provides self-service support' : 'Processes and indexes documents for knowledge base'}
                        </div>
                    </div>
                `).join('');

                listDiv.innerHTML = agentsHtml;
            },

            addExecutionEvent: (event) => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `execution-event ${event.event.replace('_', '-')}`;

                const timestamp = new Date().toLocaleTimeString();
                let content = '';

                switch (event.event) {
                    case 'agent_started':
                        content = `üöÄ Started ${event.agent}`;
                        break;
                    case 'tool_call':
                        content = `üîß Tool: ${event.tool} - ${event.input}`;
                        break;
                    case 'agent_completed':
                        content = `‚úÖ Completed ${event.agent}`;
                        break;
                    case 'final_response':
                        content = `üìù Final Response: ${event.answer.substring(0, 100)}...`;
                        break;
                    default:
                        content = `${event.event}: ${JSON.stringify(event)}`;
                }

                eventDiv.innerHTML = `
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: var(--spacing-xs);">${timestamp}</div>
                    <div>${content}</div>
                `;

                elements.executionLog.appendChild(eventDiv);
                elements.executionLog.scrollTop = elements.executionLog.scrollHeight;
            },

            updateExecutionSummary: (summary) => {
                if (!summary) {
                    elements.executionSummary.innerHTML = '<div style="color: var(--gray-500);">No active execution</div>';
                    return;
                }

                const summaryHtml = `
                    <div class="summary-item">
                        <div class="summary-label">Priority</div>
                        <div class="summary-value">${summary.priority || 'Unknown'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Agents Used</div>
                        <div class="summary-value">${(summary.agents_ran || []).join(', ') || 'None'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Data Sources</div>
                        <div class="summary-value">${(summary.data_used || []).join(', ') || 'None'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Decision Summary</div>
                        <div class="summary-value">${summary.decision_summary || 'No summary available'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Recommended Action</div>
                        <div class="summary-value">${summary.mitigation || 'No recommendation'}</div>
                    </div>
                `;

                elements.executionSummary.innerHTML = summaryHtml;
            },

            clearExecutionLog: () => {
                elements.executionLog.innerHTML = '<div style="text-align: center; color: var(--gray-500); padding: var(--spacing-xl);">Start a conversation to see live execution events</div>';
            }
        };

        // Page Management
        const pageManager = {
            switchPage: (pageId) => {
                // Update navigation
                elements.navItems.forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

                // Update pages
                elements.pages.forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(`${pageId}-page`).classList.add('active');

                // Update header
                state.currentPage = pageId;
                pageManager.updateHeader(pageId);

                // Load page data
                pageManager.loadPageData(pageId);
            },

            updateHeader: (pageId) => {
                const headers = {
                    chat: {
                        title: 'Chat with SARTHI',
                        subtitle: 'AI-powered collaborative incident co-pilot for enterprise support'
                    },
                    memory: {
                        title: 'Memory Dashboard',
                        subtitle: 'View and manage conversation memory and context'
                    },
                    agents: {
                        title: 'Agent Management',
                        subtitle: 'Configure and monitor AI agents and document ingestion'
                    },
                    observability: {
                        title: 'Observability & Explainability',
                        subtitle: 'Monitor system performance and agent execution in real-time'
                    }
                };

                const header = headers[pageId] || headers.chat;
                utils.setPageTitle(header.title, header.subtitle);
            },

            loadPageData: async (pageId) => {
                try {
                    switch (pageId) {
                        case 'memory':
                            const memoryData = await api.getMemoryItems();
                            ui.updateMemoryStats(memoryData.items || []);
                            ui.updateMemoryList(memoryData.items || []);
                            break;
                        case 'agents':
                            const agentsData = await api.getAgents();
                            ui.updateAgentsList(agentsData);
                            break;
                        case 'observability':
                            ui.clearExecutionLog();
                            ui.updateExecutionSummary(null);
                            break;
                    }
                } catch (error) {
                    console.error(`Error loading ${pageId} data:`, error);
                    utils.showAlert(`Failed to load ${pageId} data`, 'error');
                }
            }
        };

        // Chat Functionality
        const chatManager = {
            async sendMessage() {
                const message = elements.chatInput.value.trim();
                if (!message) return;

                // Add user message
                ui.addMessage('user', message);

                // Clear input and disable
                elements.chatInput.value = '';
                elements.sendButton.disabled = true;

                try {
                    utils.showLoading(true);

                    // Send message to API
                    const response = await api.sendChatMessage(message);

                    // Store execution ID for observability
                    state.currentExecutionId = response.execution_id;

                    // Start SSE for live updates
                    chatManager.startLiveUpdates(response.execution_id);

                    // For demo purposes, simulate a response
                    // In production, this would come from the SSE stream
                    setTimeout(() => {
                        ui.addMessage('assistant', 'I\'ve analyzed your query and found relevant information in our knowledge base. Let me provide you with a comprehensive response...');
                        utils.showLoading(false);
                        elements.sendButton.disabled = false;
                    }, 2000);

                } catch (error) {
                    console.error('Chat error:', error);
                    ui.addMessage('assistant', 'Sorry, I encountered an error processing your request. Please try again.');
                    utils.showAlert('Failed to send message', 'error');
                    utils.showLoading(false);
                    elements.sendButton.disabled = false;
                }
            },

            startLiveUpdates(executionId) {
                // Close existing connection
                if (state.eventSource) {
                    state.eventSource.close();
                }

                // Start new SSE connection
                try {
                    state.eventSource = new EventSource(`${CONFIG.API_BASE}/api/chat/stream/${executionId}`);

                    state.eventSource.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            ui.addExecutionEvent(data);
                        } catch (error) {
                            console.error('SSE parse error:', error);
                        }
                    };

                    state.eventSource.onerror = (error) => {
                        console.error('SSE error:', error);
                        state.eventSource.close();
                    };

                    state.eventSource.onopen = () => {
                        console.log('SSE connection opened');
                    };

                } catch (error) {
                    console.error('Failed to start live updates:', error);
                }
            }
        };

        // Form Handlers
        const formHandlers = {
            handleIngestion: async (event) => {
                event.preventDefault();

                const formData = new FormData(event.target);
                const sourceType = formData.get('source-type');
                const sourceValue = formData.get('source-value');
                const metadataText = formData.get('metadata');

                let metadata = {};
                if (metadataText) {
                    try {
                        metadata = JSON.parse(metadataText);
                    } catch (error) {
                        utils.showAlert('Invalid JSON in metadata field', 'error');
                        return;
                    }
                }

                try {
                    utils.showLoading(true);
                    const result = await api.ingestDocument(sourceType, sourceValue, metadata);

                    utils.showAlert(`Document ingested successfully! ${result.chunks_indexed || 0} chunks indexed.`, 'success');
                    event.target.reset();

                } catch (error) {
                    console.error('Ingestion error:', error);
                    utils.showAlert('Failed to ingest document', 'error');
                } finally {
                    utils.showLoading(false);
                }
            }
        };

        // Event Listeners
        const initEventListeners = () => {
            // Navigation
            elements.navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.dataset.page;
                    pageManager.switchPage(page);
                });
            });

            // Chat
            elements.sendButton.addEventListener('click', () => chatManager.sendMessage());
            elements.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    chatManager.sendMessage();
                }
            });

            // Forms
            elements.ingestionForm.addEventListener('submit', formHandlers.handleIngestion);

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + K to focus chat input
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    elements.chatInput.focus();
                }
            });
        };

        // Application Initialization
        const init = () => {
            console.log('Initializing SARTHI Frontend...');

            // Set up event listeners
            initEventListeners();

            // Load initial page data
            pageManager.loadPageData('chat');

            // Show welcome message
            utils.showAlert('Welcome to SARTHI! Connected to backend successfully.', 'success');

            console.log('SARTHI Frontend initialized successfully');
        };

        // Start the application
        document.addEventListener('DOMContentLoaded', init);

        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            utils.showAlert('An unexpected error occurred', 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            utils.showAlert('An unexpected error occurred', 'error');
        });
    </script>
</body>
</html>